<script>
// ... (CÃ¡c pháº§n Firebase vÃ  parseShift giá»¯ nguyÃªn nhÆ° trÃªn) ...

db.ref("hgs_requests").on("value", (snap) => {
    const list = snap.val();
    const container = document.getElementById("market-list");
    container.innerHTML = "";
    if(!list) {
        container.innerHTML = '<div class="text-center py-10 text-slate-400 text-sm italic">ChÆ°a cÃ³ ca nÃ o Ä‘Æ°á»£c rao bÃ¡n...</div>';
        return;
    }
    
    const entries = Object.entries(list).reverse();
    document.getElementById("count-tag").innerText = entries.length + " TIN";

    entries.forEach(([id, data]) => {
        // Táº¡o ID duy nháº¥t cho má»—i pháº§n liÃªn há»‡
        const contactId = `contact-${id}`;
        
        container.innerHTML += `
            <div class="glass-card p-5 space-y-4 border-l-4 border-l-blue-600 relative overflow-hidden transition-all">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="font-extrabold text-slate-800 text-base">${data.name}</h3>
                        <p class="text-[10px] text-blue-600 font-black uppercase tracking-wider">${data.dayText}</p>
                    </div>
                    <div class="text-right">
                        <span class="text-emerald-600 font-black text-sm">${data.price}</span>
                    </div>
                </div>
                
                <div class="flex items-center gap-3 bg-slate-50 p-3 rounded-xl border border-dashed border-slate-200">
                    <div class="text-[10px] font-bold text-slate-400 uppercase leading-none">Ca cáº§n bÃ¡n:</div>
                    <span class="shift-badge text-sm">${data.shiftCode}</span>
                </div>

                <p class="text-xs text-slate-500 font-medium italic">"${data.note || 'KhÃ´ng cÃ³ ghi chÃº thÃªm'}"</p>
                
                <div class="pt-2 border-t border-slate-50 space-y-2">
                    <div id="${contactId}" class="hidden flex items-center gap-2 animate-in fade-in duration-300">
                        <a href="https://zalo.me/${data.zalo}" target="_blank" class="zalo-btn w-full justify-center py-3 shadow-lg">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M21.5 12c0 5.247-4.253 9.5-9.5 9.5S2.5 17.247 2.5 12 6.753 2.5 12 2.5s9.5 4.253 9.5 9.5z"/></svg>
                            NHáº®N TIN ZALO NGAY
                        </a>
                    </div>
                    
                    <button id="btn-show-${id}" onclick="toggleContact('${contactId}', 'btn-show-${id}')" class="w-full py-2 text-blue-600 font-bold text-xs uppercase bg-blue-50 rounded-lg border border-blue-100">
                        ğŸ“ Báº¥m vÃ o Ä‘Ã¢y Ä‘á»ƒ liÃªn há»‡
                    </button>
                </div>

                <div class="flex items-center justify-between mt-2">
                     <button onclick="findHelpers('${data.day}', '${data.shiftCode}')" class="text-slate-400 font-bold text-[9px] uppercase hover:text-blue-600 transition-colors">
                        ğŸ” Xem ai ráº£nh Ä‘á»ƒ nhá» trá»±c tiáº¿p
                     </button>
                     <button onclick="deletePost('${id}')" class="p-1 text-slate-300 hover:text-red-500 text-xs">XÃ³a tin</button>
                </div>
            </div>
        `;
    });
});

// HÃ m Ä‘á»ƒ áº©n/hiá»‡n pháº§n liÃªn há»‡
function toggleContact(contactId, btnId) {
    const contactDiv = document.getElementById(contactId);
    const btn = document.getElementById(btnId);
    
    if(contactDiv.classList.contains('hidden')) {
        contactDiv.classList.remove('hidden');
        btn.innerText = "ÄÃ³ng thÃ´ng tin liÃªn há»‡";
        btn.classList.replace('text-blue-600', 'text-slate-400');
        btn.classList.replace('bg-blue-50', 'bg-slate-50');
    } else {
        contactDiv.classList.add('hidden');
        btn.innerText = "ğŸ“ Báº¥m vÃ o Ä‘Ã¢y Ä‘á»ƒ liÃªn há»‡";
        btn.classList.replace('text-slate-400', 'text-blue-600');
        btn.classList.replace('bg-slate-50', 'bg-blue-50');
    }
}
</script>
